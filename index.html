<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>××××Ÿ ×’××™×œ×” AI - ×™×•×¨×</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; }
        body { margin: 0; font-family: system-ui; background-color: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        .screen { flex: 1; padding: 20px; display: none; overflow-y: auto; padding-bottom: 100px; }
        .active { display: block; }

        /* Dashboard */
        .dashboard { text-align: center; }
        .timer-circle { 
            width: 220px; height: 220px; border-radius: 50%; margin: 20px auto; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border: 8px solid #1e293b; position: relative; cursor: pointer;
        }
        .timer-red { background: radial-gradient(circle, #f87171, #ef4444); box-shadow: 0 0 30px rgba(239, 68, 68, 0.4); }
        .timer-green { background: radial-gradient(circle, #4ade80, #22c55e); box-shadow: 0 0 30px rgba(34, 197, 94, 0.4); }

        /* Buttons */
        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        .btn { padding: 18px; border-radius: 18px; border: none; font-size: 1.1rem; font-weight: bold; color: white; cursor: pointer; transition: 0.1s; }
        .btn-sos { background: linear-gradient(135deg, #0ea5e9, #2563eb); }
        .btn-manual { background: #334155; }
        .btn:active { transform: scale(0.95); }

        /* Settings & Lists */
        .section { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 15px; border: 1px solid #334155; }
        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.85rem; opacity: 0.7; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }

        /* Navigation */
        .nav { position: fixed; bottom: 0; width: 100%; height: 85px; background: #1e293b; display: flex; border-top: 1px solid #334155; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.85rem; opacity: 0.5; color: white; text-decoration: none; border: none; background: none; }
        .nav-item.active { opacity: 1; color: var(--accent); }
        .nav-icon { font-size: 1.5rem; margin-bottom: 4px; }

        /* Logs Table */
        table { width: 100%; border-collapse: collapse; }
        td { padding: 15px; border-bottom: 1px solid #334155; text-align: center; }
        .status-badge { padding: 4px 8px; border-radius: 8px; font-size: 0.8rem; }
    </style>
</head>
<body>

<div id="home" class="screen active">
    <div class="dashboard">
        <div class="section" style="margin-top: 0;">
            <div style="opacity: 0.7; font-size: 0.9rem;">×¡×™×’×¨×™×•×ª ×”×™×•×</div>
            <div style="font-size: 3rem; font-weight: bold;" id="daily-status">0 <span style="font-size: 1.2rem; opacity: 0.4;">/ 43</span></div>
        </div>

        <div id="timer-btn" class="timer-circle timer-red" onclick="logSmoking()">
            <div style="font-size: 0.8rem; opacity: 0.9;" id="timer-label">×–××Ÿ ×”××ª× ×”</div>
            <div style="font-size: 3.5rem; font-weight: 200;" id="countdown">00:00</div>
            <div style="font-size: 0.8rem; margin-top: 5px;" id="interval-info">××¨×•×•×—: -- ×“×§×•×ª</div>
        </div>

        <div class="btn-row">
            <button class="btn btn-sos" onclick="logSmoking()">×¢×©× ×ª×™ ×¢×›×©×™×• ğŸš¬</button>
            <button class="btn btn-manual" onclick="alert('×”×•×¡×¤×” ×™×“× ×™×ª ×ª×ª×•×•×¡×£ ×‘×¢×“×›×•×Ÿ ×”×‘×')">âœï¸ ×™×“× ×™</button>
        </div>
    </div>
</div>

<div id="reports" class="screen">
    <h2>×”×™×¡×˜×•×¨×™×™×ª ×¢×™×©×•×Ÿ</h2>
    <div class="section">
        <table id="logs-table">
            </table>
    </div>
</div>

<div id="coach" class="screen">
    <h2>××××Ÿ ×’××™×œ×” ××™×©×™</h2>
    <div class="section" style="height: 300px; display: flex; align-items: center; justify-content: center; text-align: center;">
        <div>
            <div style="font-size: 4rem;">ğŸ™ï¸</div>
            <p id="coach-msg">×œ×—×¥ ×¢×œ ×”×œ×—×¦×Ÿ ×‘×‘×™×ª ×›×“×™ ×œ×©××•×¢ ××ª ×”××××Ÿ ×©×œ×š.</p>
        </div>
    </div>
</div>

<div id="settings" class="screen">
    <h2>×ª×•×›× ×™×ª ×”×’××™×œ×”</h2>
    <div class="section">
        <div class="input-group">
            <label>×©× ×”××©×ª××©:</label>
            <input type="text" id="user-name" onchange="saveConfig()" value="×™×•×¨×">
        </div>
        <div class="input-group">
            <label>×›××•×ª ×‘×¡×™×¡ (Baseline):</label>
            <input type="number" id="base-count" onchange="saveConfig()" value="43">
        </div>
    </div>
    <div class="section">
        <label><input type="checkbox" id="v-on" checked onchange="saveConfig()"> ×”×ª×¨××•×ª ×§×•×œ×™×•×ª (×× ×•×©×™)</label>
        <label style="margin-top:10px;"><input type="checkbox" id="vbr-on" checked onchange="saveConfig()"> ×¨×˜×˜ ×¤×¢×™×œ</label>
    </div>
    <button class="btn btn-sos" style="width: 100%;" onclick="switchTab('home')">×©××•×¨ ×•×—×–×•×¨</button>
</div>

<nav class="nav">
    <button class="nav-item active" onclick="switchTab('home', this)"><div class="nav-icon">ğŸ </div>×‘×™×ª</button>
    <button class="nav-item" onclick="switchTab('reports', this)"><div class="nav-icon">ğŸ“‹</div>×“×•×—×•×ª</button>
    <button class="nav-item" onclick="switchTab('coach', this)"><div class="nav-icon">ğŸ™ï¸</div>××××Ÿ</button>
    <button class="nav-item" onclick="switchTab('settings', this)"><div class="nav-icon">âš™ï¸</div>×”×’×“×¨×•×ª</button>
</nav>

<script>
    let state = JSON.parse(localStorage.getItem('quit_pro_v1')) || {
        logs: [],
        base: 43,
        name: '×™×•×¨×',
        voice: true,
        vbr: true
    };

    function saveConfig() {
        state.name = document.getElementById('user-name').value;
        state.base = document.getElementById('base-count').value;
        state.voice = document.getElementById('v-on').checked;
        state.vbr = document.getElementById('vbr-on').checked;
        localStorage.setItem('quit_pro_v1', JSON.stringify(state));
        render();
    }

    function switchTab(id, el) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(el) el.classList.add('active');
        if(id === 'reports') renderLogs();
    }

    function announce(txt) {
        if(!state.voice) return;
        const u = new SpeechSynthesisUtterance(txt);
        u.lang = 'he-IL';
        u.pitch = 1.0; u.rate = 0.95; // ×”×’×“×¨×” ×œ×“×™×‘×•×¨ ×× ×•×©×™ ×•×–×•×¨×
        window.speechSynthesis.speak(u);
    }

    function logSmoking() {
        const now = new Date();
        const interval = (16 * 60 * 60 / state.base) * 60000; // ×—×™×©×•×‘ ××¨×•×•×— ×××•×¦×¢
        const last = state.logs.length > 0 ? new Date(state.logs[state.logs.length-1].t) : null;
        const isDeviation = last && (now - last < interval);

        if(state.vbr) window.navigator.vibrate(50);
        
        announce(isDeviation ? "×™×•×¨×, ×–×” ××•×§×“× ××“×™. × ×¡×” ×œ×”×ª××¤×§." : "×™×•×¤×™ ×™×•×¨×, ××ª×” ×¢×•××“ ×‘×–×× ×™×.");
        
        state.logs.push({t: now.toISOString(), d: isDeviation});
        localStorage.setItem('quit_pro_v1', JSON.stringify(state));
        render();
    }

    function render() {
        const today = new Date().toDateString();
        const logs = state.logs.filter(l => new Date(l.t).toDateString() === today);
        document.getElementById('daily-status').innerHTML = `${logs.length} <span style="font-size: 1.2rem; opacity: 0.4;">/ ${state.base}</span>`;
        
        // ×¢×“×›×•×Ÿ ×˜×™×™××¨ (×œ×•×’×™×§×” ×‘×¡×™×¡×™×ª)
        const interval = (16 * 60 * 60 / state.base);
        document.getElementById('interval-info').innerText = `××¨×•×•×—: ${Math.round(interval)} ×“×§×•×ª`;
    }

    function renderLogs() {
        const today = new Date().toDateString();
        const logs = state.logs.filter(l => new Date(l.t).toDateString() === today);
        const table = document.getElementById('logs-table');
        table.innerHTML = logs.map((l, i) => `
            <tr>
                <td>${new Date(l.t).toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'})}</td>
                <td>×¡×™×’×¨×™×” ${i+1}</td>
                <td><span class="status-badge" style="background:${l.d?'#ef4444':'#22c55e'}">${l.d?'×—×¨×™×’×”':'×‘×–××Ÿ'}</span></td>
            </tr>
        `).reverse().join('');
    }

    // ×˜×™×™××¨ ×¨×¥
    setInterval(() => {
        if(state.logs.length === 0) return;
        const last = new Date(state.logs[state.logs.length-1].t);
        const wait = (16 * 60 * 60 / state.base) * 60000;
        const diff = Date.now() - last;
        const rem = Math.max(0, wait - diff);
        
        const m = Math.floor(rem / 60000);
        const s = Math.floor((rem % 60000) / 1000);
        document.getElementById('countdown').innerText = `${m}:${s.toString().padStart(2,'0')}`;
        
        const btn = document.getElementById('timer-btn');
        if(rem > 0) {
            btn.className = "timer-circle timer-red";
            document.getElementById('timer-label').innerText = "×–××Ÿ ×”××ª× ×”";
        } else {
            btn.className = "timer-circle timer-green";
            document.getElementById('timer-label').innerText = "× ×™×ª×Ÿ ×œ×¢×©×Ÿ âœ…";
        }
    }, 1000);

    render();
</script>
</body>
</html>

